---
title: "An Exploratory Analysis of Corruption and Parking Violations"
author: "Kenneth Chen, Shiraz Chakraverty, Praba Santhanakrishnan"
date: "May 28, 2018"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

__Background__
Imagine that you have been hired by the World Bank to study the eect of cultural norms and legal enforcement in controlling corruption by analyzing the parking behavior of United Nations officials in Manhattan. Until 2002, diplomatic immunity protected UN diplomats from parking enforcement actions, so diplomats actions were constrained by cultural norms alone. In 2002, enforcement authorities acquired the right to confiscate diplomatic license plates of violators, after which diplomatic behavior was constrained by both cultural norms and the legal penalties of unpaid tickets.

__Data__
You are given a dataset for a selection of UN diplomatic missions, Corrupt.R. The dependent (or target) variable in this data is named violations. The labels of some of the variables are listed below; the rest of the variables should be self-explanatory.

corruption: Country corruption index, 1998  
violations: Unpaid New York City parking violations  
trade: total trade with the United States (1998 US$)  

__Objective__
The World Bank would like to know what if any relationship there is between corruption and parking violations both pre and post 2002 and if there are any other relevant explanatory variables.

(a) Was there a relationship between corruption and parking violations?  
(b) How does the number of diplomats contribute to the frequency of violations?  
(c) Did World Trade Center attack on September 11, 2001 have any impact on the parking violations in Manhattan NY?  
(d) 


# Data Exploration

Our team, Kenneth Chen, Shiraz, Praba Santhanakrishnan from W203, will address this question using exploratory data analysis (EDA) techniques. Our data is composed of the number of parking violations, number of diplomats from countries all over the world, individual country corruption index so on and so forth. We are interested in investigating the correlation between parking violations and the corruption of the diplomat countries. How is corruption relevant to the frequency of the parking violations happened in Manhattan NY before and after the year 2002. The year '2002' was intuitively chosen to reflect the World Trade Center attack on September 11, 2001. 

## Setup

First, we load the car library, which gives us a convenient scatterplotMatrix function.

```{r car}
library(car)
install.packages("Hmisc")
library("Hmisc")

```


```{r loading}
# Load the data 
load("Corrupt.Rdata")
```

## Data Selection

We observe that we have `r nrow(FMcorrupt)` observations and `r length(colnames(FMcorrupt))` variables.

```{r shape}
dim(FMcorrupt)
str(FMcorrupt)
```

We looked at the total number of violations and found that the violations could be as low as `r format(round(min(FMcorrupt$violations, na.rm=TRUE), 2))` and could also go as frequent as `r format(round(max(FMcorrupt$violations, na.rm=TRUE), 2))`. This shows a wide discrepancy in violations, from which we could gather some insightful information regarding other factors such as corruption index and the number of diplomats visits to the US. 

Looking at the diplomat variable, i.e., staff, we notice that diplomat numbers stay between `r format(round(min(FMcorrupt$staff, na.rm=TRUE), 2))` and `r format(round(max(FMcorrupt$staff, na.rm=TRUE), 2))` 

The column'prepost' plays a key role in the defintion of the dataset and identifies whether the data is prior or post to the parking enforcement implemented in 2002. This dataset appears to be in the form of Panel or Longitudinal Data. It has both cross-sectional (Data around corruptions , violations etc) and a time series (pre vs post) dimension.

```{r violations_range}
summary(FMcorrupt$violations)
summary(FMcorrupt$staff)
```

## Data Quality

```{r shape}
head(FMcorrupt)
tail(FMcorrupt)
nrow(FMcorrupt[FMcorrupt$prepost=='',])
```

There are 62 rows that have empty string for prepost and the associated data for the other columns for these rows are 'NA' , the only column that has value for these are 'wbcode'. It is possible that the data is not either observerd or entered into the data set. These rows do not provide any meaningful information and do not add any additional value to the analysis and it can be safely removed.


## Uni variate Analysis for key variables


1. violations

```{r shape}
summary(FMcorrupt$violations)
describe(FMcorrupt$violations)
```

It appears that 3/4th of dataset habe the violations that is less than 51.9 and where as 95% of the rows have value less than or equal to 640.8 with the maximum value being 3392.9. The distribution seems to be skewed to the right. Let us do the boxplot and see the outliers clearly.


```{r shape}
boxplot(FMcorrupt$violations)
boxplot(log(FMcorrupt$violations))
```

It is very clear from the boxplot that majority of the values are below the value 51.9 , transforming the violations to the log scale gives a better picture.

```{r shape}
hist((FMcorrupt$violations)) 
hist(log(FMcorrupt$violations))
```



2. prepost

```{r shape}
pre <- FMcorrupt[FMcorrupt$prepost =='pre',]
pos <- FMcorrupt[FMcorrupt$prepost =='pos',]
```

Let's divide the data into two set and analyse the key variable 'violations'


```{r shape}
describe(pre$violations)
describe(pos$violations)
```

It is very interesting to the see mean value drop from 198.1 to 3.688 indicating such a huge change in the behaviour of diplomats since the enforcement of legal penalties and removing the immunity.


## (a) Was there a relationship between corruption and parking violations?  

Our first step is preliminary check across all key variables such as violations, staff and corruption. Interestingly, we found that there is no immediate evidence that the more the number of diplomats, the higher the violations. Most of the violations appears clustered at the lower bounds of the staff number between 0 and 20. However we observed an interesting pattern between violations and corruption. The more corrupt the country is, i.e., indicated by the corruption index, the more likely we would see the violation events. 

```{r scatterplotMatrix}
scatterplotMatrix(~ violations + staff + corruption, data=FMcorrupt, diagonal = list(method='histogram'), main = "Scatterplot Matrix for key variables")
```

Our first step is to subset the corruption index data to further zoom in to the most corrupted countries. We created subcases with below and above zero. 

```{r}
subcases_above_zero = 0 <= FMcorrupt$corruption & !is.na(FMcorrupt$corruption) 
```

```{r}
subcases_below_zero = 0 >= FMcorrupt$corruption & !is.na(FMcorrupt$corruption) 
```


```{r}
FM_subcases_above_zero = FMcorrupt[subcases_above_zero, ]
nrow(FM_subcases_above_zero)
```

```{r}
FM_subcases_below_zero = FMcorrupt[subcases_below_zero, ]
nrow(FM_subcases_below_zero)
```

We also removed any corruption observations where the event is "NA". Using the logical vector to pull out from the original data, we found that the total number of observation above corruption index 0 is `r nrow(FM_subcases_above_zero)` and observation below corruption index 0 is `r nrow(FM_subcases_below_zero)` .

```{r}
scatterplotMatrix(~ violations + corruption, data=FM_subcases_above_zero, diagonal=list(method="histogram"))
```

```{r}
scatterplotMatrix(~ violations + corruption, data=FM_subcases_below_zero, diagonal=list(method="histogram"))
```

```{r}
cor(FMcorrupt$corruption, FMcorrupt$violations, use="complete.obs")
```

```{r}
cor_below = cor(FM_subcases_below_zero$corruption, FM_subcases_below_zero$violations, use ='complete.obs')
cor_below
```

```{r}
cor_above = cor(FM_subcases_above_zero$corruption, FM_subcases_above_zero$violations, use ='complete.obs')
cor_above
```


## (b) Does religion have a role in the behaviour and violations

```{r}
scatterplot( log(violations) ~ pctmuslim       , data=FMcorrupt, 
  	ylab="Corruption", xlab="% Muslim", 
   main="Enhanced Scatter Plot" 
   )

cor(FMcorrupt$violations,FMcorrupt$pctmuslim,use="complete.obs")

```

This plot shows that there is not much  relationship between the religion and the behaviour (violations) , there are too many observations with the % muslim close to 0 and as well as 1. So the violations cannot be directly related %muslim.

## (b) Does number of cars  have a role in the behaviour and violations


```{r}
scatterplot( log(violations) ~ cars_total       , data=FMcorrupt, 
  	ylab="Corruption", xlab="# of Cars", 
   main="Enhanced Scatter Plot" 
   )

cor(FMcorrupt$violations,FMcorrupt$cars_total,use="complete.obs")

```
## Behaviour based on the continets

```{r}
africa <- FMcorrupt[FMcorrupt$r_africa ==1 & !is.na(FMcorrupt$r_africa),]
nrow(africa)/2

asia <- FMcorrupt[FMcorrupt$r_asia ==1 & !is.na(FMcorrupt$r_asia),]
nrow(asia)/2

europe <- FMcorrupt[FMcorrupt$r_europe ==1 & !is.na(FMcorrupt$r_europe),]
nrow(europe)/2

southamerica <- FMcorrupt[FMcorrupt$r_southamerica ==1 & !is.na(FMcorrupt$r_southamerica),]
nrow(southamerica)/2


middleeast <- FMcorrupt[FMcorrupt$r_middleeast ==1 & !is.na(FMcorrupt$r_middleeast),]
nrow(middleeast)/2

describe(africa$violations)
describe(asia$violations)
describe(europe$violations)
describe(southamerica$violations)
describe(middleeast$violations)

```




### Results

Upon checking the violations Vs corruption based on corruption index centered at '0', we observed that corruption is relevant in predicting the parking violation when the index is below 0 as indicated by our correlation value at `r format(round(cor_below), 2)` . However observation above the corruption index of "1"", we do not observe a strong relationship between the corruption and the parking violations as indicated by the negative value `r format(round(cor_above, 2))` . This somehow indicates that we need to further fine tune our data analysis with more variables in investigation of corruption index and parking violations. 


## (b) How does the number of diplomats contribute to the frequency of violations?  

As we observe that there are countries with the total number of diplomats at `r format(round(max(FMcorrupt$staff), 2))`, we are interested in the average number of parking violations per individual diplomats. In order to do so, we divided the violations variable by the staff number in each country. However as there are some missing value in these two variables, we first created a subdata which do not have a missing value in two critical variables, i.e., violations and staff. 

```{r}
subcases_per_dip = ! is.na(FMcorrupt$violations) & ! is.na(FMcorrupt$staff)
FM_subcases_per_dip = FMcorrupt[subcases_per_dip, ]
FM_subcases_per_dip$vpd = (FM_subcases_per_dip$violations/FM_subcases_per_dip$staff)
summary(FM_subcases_per_dip)
min_vio = format(round(min(FM_subcases_per_dip$vpd), 2))
max_vio = format(round(max(FM_subcases_per_dip$vpd), 2))
```

Interestingly we found that violations per diplomat ranges from `r min_vio` to `r max_vio` which further confirms our previous analysis that the number of staff does not correlate to the number of violations. It would otherwise indicate that the average violation would be similar across the countries. 

```{r calling the most violations country}
FM_subcases_per_dip$country[FM_subcases_per_dip$vpd == max(FM_subcases_per_dip$vpd)]
```

We found that the country that commited more parking violations in Manhattan NY was Kuwait with an outstanding violations of 249 violations per diplomats. We further investigated the variables for Kuwait.

```{r}
FM_subcases_per_dip[FM_subcases_per_dip$country=="KUWAIT", ]
```

To our surprise, violations of Kuwait pre and post 2002 was astonashing. Its pre violation stood at `r FMcorrupt$violation[FMcorrupt$country=="KUWAIT" & FMcorrupt$prepost == 'pre']` while its post violations stood at `r FMcorrupt$violations[FMcorrupt$country=="KUWAIT" & FMcorrupt$prepost == 'pos']` . The violations per diplomat therefore significantly reduced from `r FM_subcases_per_dip$vpd[FM_subcases_per_dip$country=="KUWAIT" & FM_subcases_per_dip$prepost=='pre']` to `r FM_subcases_per_dip$vpd[FM_subcases_per_dip$country=="KUWAIT" & FM_subcases_per_dip$prepost=='pos']` while all other variables remains the same. 

### Results

The number of staff does not correlate with the frequency of parking violations in New York Manhattan. Investigation of the average number of violations per diplomats clarified our previous findings that the number of diplomats did not matter. Some countries diplomat committed parking violations as high as `r max_vio`, which rather suggested other underlying causes for such a high frequency per diplomat. 



